<script type="application/json" id="VariantMediaJson-{{ section.id }}">
  [
    {% for variant in product.variants %}
      {% assign color_token = variant.option1 | downcase | replace: ' ', '-' %}
      {% assign color_match = '_' | append: color_token | append: '_' %}
      {
        "id": {{ variant.id }},
        "variantMediaHiRes": [
          {% assign first_match = true %}
          {% for variant_media in product.media %}
            {% if variant_media.media_type == 'image' %}
              {% capture media_src %}{{ variant_media | image_url: width: 150 }}{% endcapture %}
              {% assign media_src = media_src | downcase | strip %}
              {% if media_src contains color_match %}
                {% unless first_match %},{% endunless %}
                {
                  "id": "{{ variant_media.id }}",
                  "thumbnailUrl": "{{ variant_media | image_url: width: 150 }}",
                  "mediaUrl": "{{ variant_media | image_url: width: 1080, height: 1080 }}",
                  "mediaType": "{{ variant_media.media_type }}",
                  "alt": "{{ variant_media.alt | escape }}",
                  "width": "{{ variant_media.width }}",
                  "height": "{{ variant_media.height }}",
                  "sectionId": "{{ section.id }}"
                }
                {% assign first_match = false %}
              {% endif %}
            {% endif %}
          {% endfor %}
        ]
      }{% unless forloop.last %},{% endunless %}
    {% endfor %}
  ]
</script>
