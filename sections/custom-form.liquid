{% style %}
  .{{ section.settings.form_id }}-wrapper {
    max-width: {{ section.settings.form_max_width }}px;
    margin: {{ section.settings.form_margin }};
    padding: {{ section.settings.form_padding }};
    background-color: {{ section.settings.form_background }};
  }

  .{{ section.settings.form_id }}-wrapper h2 {
    font-size: 48px;
    font-weight: bold;
    margin-bottom: 0.5rem;
    color: #333;
    text-align: center;
  }

  .{{ section.settings.form_id }}-wrapper h2.no-description {
    margin-bottom: 2rem;
  }

  .{{ section.settings.form_id }}-wrapper p {
    font-size: 16px;
    margin-bottom: 2rem;
    color: #666;
    text-align: center;
  }

  .{{ section.settings.form_id }}-wrapper form {
    text-align: left;
  }

  #{{ section.settings.form_id }} .invalid-message {
    color: #e74c3c;
    font-size: 0.875rem;
    margin-top: 0.25rem;
    display: none;
  }

  #{{ section.settings.form_id }} .form-group {
    margin-bottom: 1.5rem;
  }

  #{{ section.settings.form_id }} .form-group label {
    display: block;
    margin-bottom: 0.25rem;
    font-weight: bold;
    font-size: 1rem;
    color: #333;
    text-transform: uppercase;
    font-family: var(--font-family-base);
  }

  #{{ section.settings.form_id }} .form-group label .required {
    color: #e74c3c;
    margin-left: 0.25rem;
  }

  #{{ section.settings.form_id }} .form-group .form-control,
  #{{ section.settings.form_id }} .form-group input,
  #{{ section.settings.form_id }} .form-group select,
  #{{ section.settings.form_id }} .form-group textarea {
    width: 100%;
    padding: 0.5rem;
    border: 2px solid black;
    border-radius: 0;
    font-size: 1rem;
    font-family: inherit;
    background-color: #fff;
    font-family: var(--font-family-base);
    color: #333;
  }

  #{{ section.settings.form_id }} .form-group input:focus,
  #{{ section.settings.form_id }} .form-group select:focus,
  #{{ section.settings.form_id }} .form-group textarea:focus {
    outline: none;
  }

  #{{ section.settings.form_id }} .form-group textarea {
    resize: vertical;
    min-height: 120px;
  }

  #{{ section.settings.form_id }} button {
    background-color: #000;
    color: #fff;
    border: none;
    border-radius: 0;
    padding: 0.75rem 2rem;
    font-size: 1rem;
    font-weight: 500;
    cursor: pointer;
    transition: background-color 0.2s ease;
  }

  #{{ section.settings.form_id }} button:hover {
    background-color: #333;
  }

  #{{ section.settings.form_id }} button:disabled {
    background-color: #ccc;
    cursor: not-allowed;
  }

  #{{ section.settings.form_id }} .submit-form-group {
    text-align: center;
  }

  #{{ section.settings.form_id }} .form-response-message {
    text-align: center;
    margin-top: 1.5rem;
  }

  #{{ section.settings.form_id }} .form-response-message .success-title {
    font-size: 48px;
    font-weight: bold;
    color: #333;
    margin-bottom: 0.5rem;
  }

  #{{ section.settings.form_id }} .form-response-message .success-message {
    font-size: 1rem;
    color: #333;
  }

  /* Phone Input Styles */
  #{{ section.settings.form_id }} .phone-input-wrapper {
    display: flex;
    gap: 0.5rem;
  }

  #{{ section.settings.form_id }} .phone-input-wrapper select {
    flex: 0 0 120px;
    width: 120px;
    padding: 0.5rem;
    border: 2px solid black;
    border-radius: 0;
    font-size: 1rem;
    font-family: var(--font-family-base);
    background-color: #fff;
  }

  #{{ section.settings.form_id }} .phone-input-wrapper input {
    flex: 1;
    margin: 0;
  }

  /* File Upload Styles */
  #{{ section.settings.form_id }} .file-upload-description {
    font-size: 0.875rem;
    color: #666;
    margin-bottom: 0.5rem;
    font-style: italic;
  }

  #{{ section.settings.form_id }} .form-group input[type="file"] {
    padding: 0.5rem;
    border: 2px dashed #333;
    background-color: #f9f9f9;
    cursor: pointer;
    transition: border-color 0.2s ease, background-color 0.2s ease;
    height: auto;
  }

  #{{ section.settings.form_id }} .form-group input[type="file"]:hover {
    border-color: #000;
    background-color: #f0f0f0;
  }

  #{{ section.settings.form_id }} .form-group input[type="file"]:focus {
    outline: none;
    border-color: #000;
    background-color: #fff;
  }

  @media (max-width: 768px) {
    .{{ section.settings.form_id }}-wrapper {
      padding: 1rem;
    }

    .{{ section.settings.form_id }}-wrapper h2 {
      font-size: 32px;
    }

    #{{ section.settings.form_id }} .form-group {
      margin-bottom: 1rem;
    }

    #{{ section.settings.form_id }} button {
      width: 100%;
      padding: 1rem;
    }

    #{{ section.settings.form_id }} button#fillFakeDataButton {
      margin-bottom: 1rem;
    }

    #{{ section.settings.form_id }} .phone-input-wrapper {
      flex-direction: row;
      gap: 0.5rem;
    }

    #{{ section.settings.form_id }} .phone-input-wrapper select {
      flex: none;
    }
  }
{% endstyle %}

<div class="form-wrapper {{ section.settings.form_id }}-wrapper">
  <div class="form-header">
    {% if section.settings.form_name != blank %}
      <h2 class="form-title {% if section.settings.form_description == blank %} no-description {% endif %}">
        {{ section.settings.form_name }}
      </h2>
    {% endif %}
    {% if section.settings.form_description != blank %}
      {% assign form_description_lines = section.settings.form_description | split: '\n' %}
      {% for line in form_description_lines %}
        <p class="form-description {% if forloop.last %}mb-4{% else %}mb-2{% endif %}">{{ line | strip }}</p>
      {% endfor %}
    {% endif %}
  </div>

  <form
    id="{{ section.settings.form_id }}"
    class="custom-form-element {{ section.settings.form_id }}-form"
    action="{{ section.settings.form_action }}"
    method="{{ section.settings.form_method }}"
  >
    <div class="form-inner">
      {% for block in section.blocks %}
        {% case block.type %}
          {% when 'input' %}
            <div class="form-group input-form-group {{ block.settings.input_name | replace: '.', '' }}-form-group">
              {% if block.settings.input_type != 'hidden' %}
                <label for="{{ block.settings.input_name }}">
                  {{ block.settings.title }}
                  {% if block.settings.required -%}
                    <span class="required">*</span>
                  {%- endif %}
                </label>
              {% endif %}

              {% if block.settings.input_type == 'phone' %}
                {% render 'custom-form-phone',
                  input_name: block.settings.input_name,
                  required: block.settings.required,
                  default_value: block.settings.default_value,
                  error_message: block.settings.error_message,
                  min_length: block.settings.min_length,
                  max_length: block.settings.max_length
                %}
              {% endif %}

              {% if block.settings.input_type != 'phone' %}
                <input
                  type="{{ block.settings.input_type }}"
                  name="{{ block.settings.input_name }}"
                  id="{{ block.settings.input_name }}"
                  autocomplete="on"
                  class="form-control"
                  {% if block.settings.required %}
                    required
                  {% endif %}
                  {% if block.settings.input_type == 'email' %}
                    pattern="[a-z0-9A-Z._\%+\-]+@[a-z0-9.\-]+\.[a-z]{2,}$"
                    title="Please enter a valid email address."
                  {% endif %}
                  {% if block.settings.default_value != blank %}
                    value="{{ block.settings.default_value }}"
                  {% endif %}
                  {% if block.settings.min_length %}
                    minlength="{{ block.settings.min_length }}"
                  {% endif %}
                  {% if block.settings.max_length %}
                    maxlength="{{ block.settings.max_length }}"
                  {% endif %}
                >
              {% endif %}
              <div class="invalid-message">{{ block.settings.error_message }}</div>
            </div>
          {% when 'select' %}
            <div class="form-group select-form-group {{ block.settings.select_name | replace: '.', '' }}-form-group">
              <label for="{{ block.settings.select_name }}">
                {{ block.settings.title }}
                {% if block.settings.required -%}
                  <span class="required">*</span>
                {%- endif %}
              </label>
              <select
                name="{{ block.settings.select_name }}"
                id="{{ block.settings.select_name }}"
                class="form-control"
                {% if block.settings.required %}
                  required
                {% endif %}
              >
                {% assign options = block.settings.select_values | split: ',' %}
                {% for opt in options %}
                  {% assign opt_value = opt | strip %}
                  <option
                    value="{{ opt_value }}"
                    {% if opt_value == block.settings.default_value %}
                      selected
                    {% endif %}
                  >
                    {{ opt_value }}
                  </option>
                {% endfor %}
              </select>
              <div class="invalid-message">{{ block.settings.error_message }}</div>
            </div>
          {% when 'textarea' %}
            <div class="form-group textarea-form-group {{ block.settings.textarea_name | replace: '.', '' }}-form-group">
              <label for="{{ block.settings.textarea_name }}">
                {{ block.settings.title }}
                {% if block.settings.required -%}
                  <span class="required">*</span>
                {%- endif %}
              </label>
              <textarea
                name="{{ block.settings.textarea_name }}"
                id="{{ block.settings.textarea_name }}"
                class="form-control"
                {% if block.settings.required %}
                  required
                {% endif %}
                {% if block.settings.min_length %}
                  minlength="{{ block.settings.min_length }}"
                {% endif %}
                {% if block.settings.max_length %}
                  maxlength="{{ block.settings.max_length }}"
                {% endif %}
              ></textarea>
              <div class="invalid-message">{{ block.settings.error_message }}</div>
            </div>
          {% when 'file_upload' %}
            {% assign max_files_size = block.settings.max_files_size | default: 5 %}
            {% assign max_total_files = block.settings.max_total_files | default: 5 %}
            <div class="form-group file-form-group {{ block.settings.file_name | replace: '.', '' }}-form-group">
              <label for="{{ block.settings.file_name }}">
                {{ block.settings.title }}
                {% if block.settings.required -%}
                  <span class="required">*</span>
                {%- endif %}
              </label>
              <div class="file-upload-description">
                Supported file types:
                {{ block.settings.accepted_file_types | replace: '.', '' | default: 'All files' }} | Max size:
                {{ max_files_size }}MB | Max total files:
                {{ max_total_files }}
              </div>
              <input
                type="file"
                name="{{ block.settings.file_name }}{% if block.settings.upload_mode == 'multiple' %}[]{% endif %}"
                id="{{ block.settings.file_name }}"
                class="form-control"
                {% if block.settings.required %}
                  required
                {% endif %}
                {% if block.settings.accepted_file_types != blank %}
                  accept="{{ block.settings.accepted_file_types }}"
                {% endif %}
                {% if block.settings.upload_mode == 'multiple' %}
                  multiple
                {% endif %}
                {% if block.settings.compress_files %}
                  data-compress-files="true"
                {% endif %}
                enctype="multipart/form-data"
                data-max-files-size="{{ max_files_size }}"
                data-max-total-files="{{ max_total_files }}"
              >
              <div class="invalid-message">{{ block.settings.error_message }}</div>
            </div>
        {% endcase %}
      {% endfor %}
      {% if section.settings.enable_recaptcha %}
        <div class="form-group gRecaptchaCheckbox-form-group">
          <div id="gRecaptcha" class="g-recaptcha" data-sitekey="{{ section.settings.recaptcha_sitekey }}"></div>
          <input
            type="checkbox"
            name="gRecaptchaCheckbox"
            id="gRecaptchaCheckbox"
            class="form-control faker-skip d-none"
            required
          >
          <div
            data-default-error="{{ section.settings.recaptcha_default_error_message }}"
            class="invalid-message"
          >
            {{ section.settings.recaptcha_default_error_message }}
          </div>
        </div>
      {% endif %}
      <div class="form-group submit-form-group">
        {% if section.settings.show_fake_data_button and settings.enable_fakerjs %}
          <button type="button" id="fillFakeDataButton" class="me-2">Fill with fake data</button>
        {% endif %}
        <button type="submit">{{ section.settings.button_text }}</button>
      </div>
    </div>
    {% for block in section.blocks %}
      {% if block.type == 'success' %}
        <div class="form-response-message" style="display: none;">
          <p class="success-title">{{ block.settings.title }}</p>
          <p class="success-message">{{ block.settings.message }}</p>
        </div>
      {% endif %}
    {% endfor %}
  </form>
</div>

{% schema %}
{
  "name": "Custom Form",
  "class": "custom-form",
  "settings": [
    {
      "type": "text",
      "id": "form_id",
      "label": "Form ID",
      "default": "custom_form"
    },
    {
      "type": "text",
      "id": "form_name",
      "label": "Form name",
      "default": "Contact Us"
    },
    {
      "type": "text",
      "id": "form_description",
      "label": "Form description (break lines with '\\n')",
      "default": "Please fill in the form below."
    },
    {
      "type": "text",
      "id": "form_action",
      "label": "Form action URL",
      "default": "#"
    },
    {
      "type": "select",
      "id": "form_method",
      "label": "Form method",
      "default": "POST",
      "options": [
        { "value": "GET", "label": "GET" },
        { "value": "POST", "label": "POST" }
      ]
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Submit button text",
      "default": "Submit"
    },
    {
      "type": "number",
      "id": "form_max_width",
      "label": "Form max width (px)",
      "default": 600
    },
    {
      "type": "text",
      "id": "form_margin",
      "label": "Form margin (CSS shorthand)",
      "default": "0 auto"
    },
    {
      "type": "text",
      "id": "form_padding",
      "label": "Form padding (CSS shorthand)",
      "default": "20px"
    },
    {
      "type": "color",
      "id": "form_background",
      "label": "Form background color",
      "default": "#ffffff"
    },
    {
      "type": "checkbox",
      "id": "show_fake_data_button",
      "label": "Show 'Fill with fake data' button for testing",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "enable_recaptcha",
      "label": "Enable Google reCAPTCHA",
      "default": true
    },
    {
      "type": "text",
      "id": "recaptcha_sitekey",
      "label": "Google reCAPTCHA sitekey"
    },
    {
      "type": "text",
      "id": "recaptcha_default_error_message",
      "label": "Google reCAPTCHA default error message",
      "default": "Please verify that you are not a robot."
    }
  ],
  "blocks": [
    {
      "type": "input",
      "name": "FG Input",
      "settings": [
        {
          "type": "checkbox",
          "id": "required",
          "label": "Required",
          "default": false
        },
        {
          "type": "select",
          "id": "input_type",
          "label": "Type",
          "default": "text",
          "options": [
            { "value": "text", "label": "Text" },
            { "value": "email", "label": "Email" },
            { "value": "hidden", "label": "Hidden" },
            { "value": "phone", "label": "Phone" }
          ]
        },
        {
          "type": "text",
          "id": "input_name",
          "label": "Name"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Label"
        },
        {
          "type": "number",
          "id": "min_length",
          "label": "Min length"
        },
        {
          "type": "number",
          "id": "max_length",
          "label": "Max length"
        },
        {
          "type": "text",
          "id": "default_value",
          "label": "Default value"
        },
        {
          "type": "text",
          "id": "error_message",
          "label": "Error message"
        }
      ]
    },
    {
      "type": "select",
      "name": "FG Select",
      "settings": [
        {
          "type": "checkbox",
          "id": "required",
          "label": "Required",
          "default": false
        },
        {
          "type": "text",
          "id": "select_name",
          "label": "Name"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Label"
        },
        {
          "type": "textarea",
          "id": "select_values",
          "label": "Values (comma separated)",
          "default": "Option 1,Option 2,Option 3"
        },
        {
          "type": "text",
          "id": "default_value",
          "label": "Default value"
        },
        {
          "type": "text",
          "id": "error_message",
          "label": "Error message"
        }
      ]
    },
    {
      "type": "textarea",
      "name": "FG Textarea",
      "settings": [
        {
          "type": "checkbox",
          "id": "required",
          "label": "Required",
          "default": false
        },
        {
          "type": "text",
          "id": "textarea_name",
          "label": "Name"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Label"
        },
        {
          "type": "number",
          "id": "min_length",
          "label": "Min length"
        },
        {
          "type": "number",
          "id": "max_length",
          "label": "Max length"
        },
        {
          "type": "text",
          "id": "error_message",
          "label": "Error message"
        }
      ]
    },
    {
      "type": "file_upload",
      "name": "FG File Upload",
      "settings": [
        {
          "type": "checkbox",
          "id": "required",
          "label": "Required",
          "default": false
        },
        {
          "type": "text",
          "id": "file_name",
          "label": "Name"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Label"
        },
        {
          "type": "text",
          "id": "accepted_file_types",
          "label": "Accepted file types (comma separated)",
          "default": ".jpg,.png,.pdf"
        },
        {
          "type": "number",
          "id": "max_files_size",
          "label": "Max files size (MB)",
          "default": 5
        },
        {
          "type": "number",
          "id": "max_total_files",
          "label": "Max total files",
          "default": 5
        },
        {
          "type": "select",
          "id": "upload_mode",
          "label": "File upload mode",
          "default": "single",
          "options": [
            { "value": "single", "label": "Single" },
            { "value": "multiple", "label": "Multiple" }
          ]
        },
        {
          "type": "checkbox",
          "id": "compress_files",
          "label": "Compress files when uploading (for images only)",
          "default": false
        },
        {
          "type": "text",
          "id": "error_message",
          "label": "Error message"
        }
      ]
    },
    {
      "type": "success",
      "name": "FG Response",
      "settings": [
        {
          "type": "text",
          "id": "title",
          "label": "Success title",
          "default": "Thank you!"
        },
        {
          "type": "textarea",
          "id": "message",
          "label": "Success message",
          "default": "Your form has been submitted successfully."
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Custom Form",
      "category": "8. Forms"
    }
  ]
}
{% endschema %}
